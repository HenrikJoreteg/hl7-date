{"version":3,"file":"hl7-date.umd.js","sources":["../src/hl7-date.js"],"sourcesContent":["const timeZoneDelimiterRe = /[\\+\\-]/\nconst getSection = (str, start, end) => {\n  const section = str.slice(start, end)\n  return section ? Number(section) : 0\n}\n\nconst toMilliseconds = str => Math.round(Number('0.' + str) * 1000)\n\n// Specifies a point in time using a 24-hour clock notation.\n// Format: YYYY[MM[DD[HH[MM[SS[.S[S[S[S]]]]]]]]][+/-ZZZZ].\nexport const parse = input => {\n  debugger\n  const [str, timeZoneOffset] = input.split(timeZoneDelimiterRe)\n  const year = getSection(str, 0, 4)\n  let month = getSection(str, 4, 6)\n  if (month) {\n    month = month - 1\n  }\n  const day = getSection(str, 6, 8) || 1\n  let hour = getSection(str, 8, 10)\n  let min = getSection(str, 10, 12)\n  const seconds = getSection(str, 12, 14)\n  const msString = str.split('.')[1]\n  const milliseconds = msString ? toMilliseconds(msString) : ''\n\n  let minuteAdjustments = 0\n  if (timeZoneOffset) {\n    const isNegative = input.includes('-')\n    const multiplier = isNegative ? 1 : -1\n    const offsetHours = getSection(timeZoneOffset, 0, 2)\n    const offsetMinutes = getSection(timeZoneOffset, 2, 4)\n    if (offsetHours) {\n      minuteAdjustments += offsetHours * multiplier * 60\n    }\n    if (offsetMinutes) {\n      minuteAdjustments += offsetMinutes * multiplier\n    }\n  }\n\n  const args = [year, month, day, hour, min, seconds, milliseconds]\n\n  let date = new Date(...args)\n\n  if (timeZoneOffset) {\n    // if we're given a timezone offset, use it\n    date = new Date(Date.UTC(...args) + minuteAdjustments * 60000)\n  }\n\n  return date\n}\n\nconst fnMap = {\n  getMilliseconds: 'millisecond',\n  getSeconds: 'second',\n  getMinutes: 'minute',\n  getHours: 'hour',\n  getDate: 'date',\n  getMonth: 'month',\n}\nconst determinePrecision = date => {\n  for (const fnName in fnMap) {\n    const value = date[fnName]()\n    let isMatch = !!value\n    if (fnName === 'getDate') {\n      isMatch = value !== 1\n    }\n    if (isMatch) {\n      return fnMap[fnName]\n    }\n  }\n  return 'year'\n}\n\nconst getTimeZoneAddOn = offsetMinutes => {\n  if (!offsetMinutes) {\n    return '+0000'\n  }\n  const plusMinus = offsetMinutes > 0 ? '-' : '+'\n  const hours = Math.floor(offsetMinutes / 60)\n    .toString()\n    .padStart(2, 0)\n  return plusMinus + hours + (offsetMinutes % 60).toString().padStart(2, 0)\n}\n\n// year, date, month, hour, minute, second, millisecond\nexport const stringify = (date, precisionSpec) => {\n  const precision = precisionSpec || determinePrecision(date)\n  const includeTimeZoneOffset = !['year', 'month', 'date'].includes(precision)\n  const timeZoneAddOn = includeTimeZoneOffset\n    ? getTimeZoneAddOn(date.getTimezoneOffset())\n    : ''\n  const endIndex = {\n    millisecond: 7,\n    second: 6,\n    minute: 5,\n    hour: 4,\n    date: 3,\n    month: 2,\n    year: 1,\n  }[precision]\n  return (\n    [\n      'getFullYear',\n      'getMonth',\n      'getDate',\n      'getHours',\n      'getMinutes',\n      'getSeconds',\n      'getMilliseconds',\n    ]\n      .slice(0, endIndex)\n      .reduce((res, fnName, index) => {\n        let value = date[fnName]()\n        // silly javascript months\n        if (index === 1) {\n          value = value + 1\n        }\n        const str = value + ''\n        if (index === 6) {\n          if (!value) {\n            return res\n          } else {\n            // strips trailing zeros\n            // *NOTE: cannot just do the Number transformation\n            // at the end because JS does crazy things on larger\n            // floats. The decimals change, for example:\n            // Number('20101203231524.029') becomes: 20101203231524.027\n            // so we do it just with the decimal\n            const decimalEnding = Number(\n              '0.' + (value + '').padStart(3, '0')\n            ).toString()\n            return res + decimalEnding.slice(1, 5)\n          }\n        }\n        return res + (index === 0 ? str : str.padStart(2, 0))\n      }, '') + timeZoneAddOn\n  )\n}\n"],"names":["timeZoneDelimiterRe","getSection","str","start","end","section","slice","Number","fnMap","getMilliseconds","getSeconds","getMinutes","getHours","getDate","getMonth","input","split","timeZoneOffset","year","month","day","hour","min","seconds","msString","milliseconds","Math","round","toMilliseconds","minuteAdjustments","multiplier","includes","offsetHours","offsetMinutes","args","date","Date","UTC","precisionSpec","precision","fnName","value","isMatch","determinePrecision","timeZoneAddOn","getTimezoneOffset","floor","toString","padStart","millisecond","second","minute","reduce","res","index"],"mappings":"osBAAA,IAAMA,EAAsB,SACtBC,EAAa,SAACC,EAAKC,EAAOC,GAC9B,IAAMC,EAAUH,EAAII,MAAMH,EAAOC,GACjC,OAAOC,EAAUE,OAAOF,GAAW,GAgD/BG,EAAQ,CACZC,gBAAiB,cACjBC,WAAY,SACZC,WAAY,SACZC,SAAU,OACVC,QAAS,OACTC,SAAU,iBA/CS,SAAAC,GAAS,MAEEA,EAAMC,MAAMhB,GAAnCE,OAAKe,OACNC,EAAOjB,EAAWC,EAAK,EAAG,GAC5BiB,EAAQlB,EAAWC,EAAK,EAAG,GAC3BiB,IACFA,GAAgB,GAElB,IAAMC,EAAMnB,EAAWC,EAAK,EAAG,IAAM,EACjCmB,EAAOpB,EAAWC,EAAK,EAAG,IAC1BoB,EAAMrB,EAAWC,EAAK,GAAI,IACxBqB,EAAUtB,EAAWC,EAAK,GAAI,IAC9BsB,EAAWtB,EAAIc,MAAM,KAAK,GAC1BS,EAAeD,EAjBA,SAAAtB,UAAOwB,KAAKC,MAA2B,IAArBpB,OAAO,KAAOL,IAiBrB0B,CAAeJ,GAAY,GAEvDK,EAAoB,EACxB,GAAIZ,EAAgB,CAClB,IACMa,EADaf,EAAMgB,SAAS,KACF,GAAK,EAC/BC,EAAc/B,EAAWgB,EAAgB,EAAG,GAC5CgB,EAAgBhC,EAAWgB,EAAgB,EAAG,GAChDe,IACFH,GAAqBG,EAAcF,EAAa,IAE9CG,IACFJ,GAAqBI,EAAgBH,GAIzC,IAAMI,EAAO,CAAChB,EAAMC,EAAOC,EAAKC,EAAMC,EAAKC,EAASE,GAEhDU,IAAWC,KAAQF,GAOvB,OALIjB,IAEFkB,EAAO,IAAIC,KAAKA,KAAKC,UAALD,KAAYF,GAA4B,IAApBL,IAG/BM,eAqCgB,SAACA,EAAMG,GAC9B,IAbuBL,EAajBM,EAAYD,GA3BO,SAAAH,GACzB,IAAK,IAAMK,KAAUhC,EAAO,CAC1B,IAAMiC,EAAQN,EAAKK,KACfE,IAAYD,EAIhB,GAHe,YAAXD,IACFE,EAAoB,IAAVD,GAERC,EACF,OAAOlC,EAAMgC,GAGjB,MAAO,OAgB4BG,CAAmBR,GAEhDS,EADyB,CAAC,OAAQ,QAAS,QAAQb,SAASQ,GAG9D,IAjBmBN,EAgBFE,EAAKU,sBAZRZ,EAAgB,EAAI,IAAM,KAC9BP,KAAKoB,MAAMb,EAAgB,IACtCc,WACAC,SAAS,EAAG,IACaf,EAAgB,IAAIc,WAAWC,SAAS,EAAG,GAN9D,QAyBT,MACE,CACE,cACA,WACA,UACA,WACA,aACA,aACA,mBAEC1C,MAAM,EAnBM,CACf2C,YAAa,EACbC,OAAQ,EACRC,OAAQ,EACR9B,KAAM,EACNc,KAAM,EACNhB,MAAO,EACPD,KAAM,GACNqB,IAYGa,OAAO,SAACC,EAAKb,EAAQc,GACpB,IAAIb,EAAQN,EAAKK,KAEH,IAAVc,IACFb,GAAgB,GAElB,IAAMvC,EAAMuC,EAAQ,GACpB,OAAc,IAAVa,EACGb,EAYIY,EAHe9C,OACpB,MAAQkC,EAAQ,IAAIO,SAAS,EAAG,MAChCD,WACyBzC,MAAM,EAAG,GAX7B+C,EAcJA,GAAiB,IAAVC,EAAcpD,EAAMA,EAAI8C,SAAS,EAAG,KACjD,IAAMJ"}